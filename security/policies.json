{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://www.krakend.io/schema/security/policy.json",
    "title": "Securiy Policies",
    "description": "The policies engine allows you to write custom sets of policies that are validated during requests, responses, or token validation.\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
    "type": "object",
    "additionalProperties": false,
    "patternProperties": {
        "^[@$_#]": {}
    },
    "anyOf": [
        {
            "required": [
                "req"
            ]
        },
        {
            "required": [
                "resp"
            ]
        },
        {
            "required": [
                "jwt"
            ]
        }
    ],
    "properties": {
        "req": {
            "title": "Request policies",
            "description": "All the policies applied in the request context.\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
            "type": "object",
            "required": ["policies"],
            "properties": {
                "policies": {
                    "title": "Policies",
                    "description": "An array with all the policies to evaluate. Each policy is represented as a string\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
                    "type": "array",
                    "items": {
                        "type": "string",
                        "title": "The policy you want to evaluate"
                    }
                },
                "error": {
                    "type": "object",
                    "properties": {
                        "body": {
                            "title": "Error body",
                            "description": "Leave an empty string to return the validation error, or write a string or object with the error response body.\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
                            "anyOf": [{
                                "type": "object"
                            },
                            {
                                "type": "string"
                            }],
                            "default": ""
                        },
                        "status": {
                            "title": "HTTP status code",
                            "description": "The HTTP status code you want to return when the validation fails.\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
                            "type": "integer",
                            "default": 500
                        }
                    }
                }
            }
        },
        "resp": {
            "title": "Response policies",
            "description": "All the policies applied in the response context.\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
            "type": "object",
            "required": ["policies"],
            "properties": {
                "policies": {
                    "title": "Policies",
                    "description": "An array with all the policies to evaluate. Each policy is represented as a string\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
                    "type": "array",
                    "items": {
                        "type": "string",
                        "title": "The policy you want to evaluate"
                    }
                },
                "error": {
                    "type": "object",
                    "properties": {
                        "body": {
                            "title": "Error body",
                            "description": "Leave an empty string to return the validation error, or write a string or object with the error response body.\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
                            "anyOf": [{
                                "type": "object"
                            },
                            {
                                "type": "string"
                            }],
                            "default": ""
                        },
                        "status": {
                            "title": "HTTP status code",
                            "description": "The HTTP status code you want to return when the validation fails.\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
                            "type": "integer",
                            "default": 500
                        }
                    }
                }
            }
        },
        "jwt": {
            "title": "JWT policies",
            "description": "All the policies applied in the JWT context (token validation).\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
            "type": "object",
            "required": ["policies"],
            "properties": {
                "policies": {
                    "title": "Policies",
                    "description": "An array with all the policies to evaluate. Each policy is represented as a string\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
                    "type": "array",
                    "items": {
                        "type": "string",
                        "title": "The policy you want to evaluate"
                    }
                },
                "error": {
                    "type": "object",
                    "properties": {
                        "body": {
                            "title": "Error body",
                            "description": "Leave an empty string to return the validation error, or write a string or object with the error response body.\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
                            "anyOf": [{
                                "type": "object"
                            },
                            {
                                "type": "string"
                            }],
                            "default": ""
                        },
                        "status": {
                            "title": "HTTP status code",
                            "description": "The HTTP status code you want to return when the validation fails.\n\nSee: https://www.krakend.io/docs/service-settings/security-policies/",
                            "type": "integer",
                            "default": 500
                        }
                    }
                }
            }
        },
        "disable_macros": {
            "title": "Disable macros",
            "description": "Pre-built macros can be disabled in those policies not needing them for a faster evaluation.",
            "type": "boolean",
            "default": false
        },
        "debug": {
            "title": "Debug",
            "description": "When the debug mode is enabled all the inputs and evaluation results are printed in the console.",
            "type": "boolean",
            "default": false
        }
    }
}